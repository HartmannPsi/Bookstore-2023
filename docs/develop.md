# SJTUACM大作业 Bookstore-2023
## Hartmann_Psi
***
## 主体逻辑：
### 头文件：
- `account.hpp`：管理账户系统
  - `class Account`：账户存储单元
  - `private:`
    - `char name[]`
    - `char id[]`
    - `char password[]`
    - `Level prev`
  - `public:`
    - `bool operator>, <, >=, <=, ==`：基于`id`字典序顺序插入、删除、查找
    - `Account operator=`：赋值
    - `friend std::ostream &operator<<`：用于打印调试
  - `class LogStack`：底层使用`std::vector`模拟登入栈的行为
  - `public:`
    - `std::vector<Account> acc_stack`
    - `std::vector<Book> book_stack`
    - `void push`：登入账户
    - `void select`：当前账户选书
    - `bool check_acc`：检查栈中是否存在与`acc`字典序相同的账户
    - `void pop`：登出账户
    - `Account top`：当前账户
    - `int size`：登入栈大小
    - `Book &slct_book`：当前选择书籍
    - `void modify`：将栈中所有与`val_old`相同的值修改为`val_new`
  - `class AccountSys`：账户系统对象
  - `private:`
    - `List<Account> database`：块状链表类
    - `LogStack log_stack`：登录栈
  - `public:`
    - `void login / logout / regin / passwd / useradd / erase`：题目要求的相应功能
    - `Level telllvl`：返回登录栈顶账号的权限等级
    - `Account tellacc`：返回登录栈顶账户类
    - `void print`：用于打印调试
    - `Book &slct_book`
    - `void modify`
- `block_list.hpp`：块状链表模板
  - `class Node<T>`：存储在外存中的块的类
    - `public:`
    - `unsigned long size`
    - `unsigned long next`
    - `T data[sqN]`
  - `class List<T>`：实现块状链表插入、删除、查找操作的类
  - `private:`
    - `std::string file_name`：文件名
    - `std::fstream file`：文件读写类
    - `unsigned long end`：块状链表的末尾所在位置
    - `const unsigned long SIZE`：每个块所占空间大小
  - `public:`
    - `void insert`：功能见前置作业
    - `virtual void erase`：功能见前置作业
    - `std::vector<T> *get`：功能见前置作业
    - `unsigned long count`：返回字典序与`val`相同的元素个数
    - `T find`：返回字典序与`val`相同的一个元素
    - `virtual bool update`：将字典序与`val`相同的一个元素修改为`val`
    - `void print`：用于打印调试
  - `class Index`：索引储存单元
  - `public:`
    - `char index[]`
    - `char isbn[]`
    - `bool operator<, >, <=, >=, ==`
    - `Index operator=`
    - `friend std::ostream &operator<<`
    - `friend bool strictly_equal`：如果两个元素的`key`和`value`都相同，则返回`true`，否则返回`false`
  - `class MultiList: public List<Index>`：对`Index`类进行存储的特化块状链表类
  - `public:`
    - `void erase`：删除与`val`完全相同的值（`strictly_equal`）
    - `bool update`：将与`val_old`完全相同的值更改为`val_new`，若不存在这样的值则直接插入`val_new`
- `command.hpp`：接受、检查输入&调用相应接口
  - `class Command`：实现单条指令功能的类
  - `private:`
    - `std::string text`：指令原始文本
  - `public:`
    - `void execute`：根据指令文本执行对应操作
  - `class CommandSys`：指令系统对象
  - `private`:
    - `Command latest_command`：最新的输入指令
  - `public`:
    - `void read`：从字符串读取指令
    - `void execute`：执行最新的输入指令
- `string_check.hpp`：字符串合法性检查
  - `bool num_letter_underscore`：仅含数字、字母、下划线
  - `bool non_invisible`：除不可见字符外的ASCII字符集
  - `bool non_invisible_quotes`：除不可见字符及英文双引号外的ASCII字符集
  - `bool check_keyword`：检查关键词合法性（是否存在空词）
  - `bool check_keyword_non_repetition`：检查关键词合法性（是否存在空词&重复词）
  - `bool check_int`：检查是否符合整型输入要求
  - `bool check_float`：检查是否符合实型输入要求
  - `std::string trim`：去除字符串头尾空格
- `book.hpp`：书籍系统
  - `class Book`：书籍存储单元
  - `public:`
    - `char isbn[]`
    - `char name[]`
    - `char author[]`
    - `char keyword[]`
    - `int quantity`
    - `double price`
    - `bool operator>, <, >=, <=, ==`
    - `Book operator=`
    - `friend std::ostream &operator<<`
  - `class BookSys`：书籍系统对象
  - `private:`
    - `List<Book> database_isbn`：以`ISBN`为`key`的块状链表
    - `MultiList index_name`
    - `MultiList index_author`
    - `MultiList index_keyword`
  - `public:`
    - `void show / buy / select / modify / import`
    - `void select_clear`：清除选择书籍
    - `Book select_book`：返回选择书籍
    - `void print_id_name`：将`index_name`中元素按字典序打印调试
    - `void print_id_author`：将`index_author`中元素按字典序打印调试
    - `void print_id_keyword`：将`index_keyword`中元素按字典序打印调试
- `diary.hpp`：目前为空，计划用于构建日志系统
  - `class Linear`：线性表类，用于存储财务收支信息
  - `private:`
    - `std::string file_name`：文件名
    - `std::fstream file`：文件读写类
  - `public:`
    - `void write`：写入收支信息
    - `void finance`：实现`show finance`功能
### 存储：
- `accounts.dat`：存储账户信息
- `books_ISBN.dat`：以`ISBN`为`key`存储书籍信息
- `index_name.dat`：以`name`为索引储存`ISBN`信息
- `index_author.dat`：以`author`为索引储存`ISBN`信息
- `index_keyword.dat`：以`keyword`为索引储存`ISBN`信息
- `finance.dat`：存储收支信息